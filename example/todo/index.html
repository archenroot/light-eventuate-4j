<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>TodoList - Light Eventuate - An event sourcing and CQRS framework with Kafka</title>
    <meta name="generator" content="Hugo 0.21-DEV" />

    
    <meta name="description" content="Light Eventuate Docs">
    
    <link rel="canonical" href="https://networknt.github.io/light-eventuate/example/todo/">
    
    <meta name="author" content="Steve Hu, Gavin Chen">
    

    <meta property="og:url" content="https://networknt.github.io/light-eventuate/example/todo/">
    <meta property="og:title" content="Light Eventuate - An event sourcing and CQRS framework with Kafka">
    <meta property="og:image" content="https://networknt.github.io/light-eventuate/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Light Eventuate - An event sourcing and CQRS framework with Kafka">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://networknt.github.io/light-eventuate/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://networknt.github.io/light-eventuate/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://networknt.github.io/light-eventuate/fonts/icon.eot');
        src: url('https://networknt.github.io/light-eventuate/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://networknt.github.io/light-eventuate/fonts/icon.woff')
               format('woff'),
             url('https://networknt.github.io/light-eventuate/fonts/icon.ttf')
               format('truetype'),
             url('https://networknt.github.io/light-eventuate/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://networknt.github.io/light-eventuate/stylesheets/application.css">
    <link rel="stylesheet" href="https://networknt.github.io/light-eventuate/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://networknt.github.io/light-eventuate/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://networknt.github.io/light-eventuate/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://networknt.github.io/light-eventuate/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-red palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        TodoList
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/stevehu" title="@stevehu on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/networknt/light-eventuate" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://networknt.github.io/light-eventuate/images/logo.png">
        </div>
      
      <div class="name">
        <strong>Light Eventuate - An event sourcing and CQRS framework with Kafka <span class="version">1.2.7</span></strong>
        
          <br>
          networknt/light-eventuate
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/networknt/light-eventuate/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/networknt/light-eventuate/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Introduction" href="https://networknt.github.io/light-eventuate/index.html">
	
	Introduction
</a>



  
</li>



<li>
  
    



<a  title="Getting started" href="https://networknt.github.io/light-eventuate/getting-started/">
	
	Getting started
</a>



  
</li>



<li>
  
    



<a  title="Architecture" href="https://networknt.github.io/light-eventuate/architecture/">
	
	Architecture
</a>



  
</li>



<li>
  
    



<a  title="Design" href="https://networknt.github.io/light-eventuate/design/">
	
	Design
</a>



  
</li>



<li>
  
    



<a  title="Tutorials" href="https://networknt.github.io/light-eventuate/tutorial/">
	
	Tutorials
</a>



  
</li>



<li>
  
    



<a  title="Examples" href="https://networknt.github.io/light-eventuate/example/">
	
	Examples
</a>



  
</li>



<li>
  
    



<a  title="Issues &amp; Help" href="https://github.com/networknt/light-eventuate/issues">
	
	Issues &amp; Help
</a>



  
</li>



<li>
  
    



<a  title="Roadmap" href="https://networknt.github.io/light-eventuate/roadmap/">
	
	Roadmap
</a>



  
</li>



<li>
  
    



<a  title="License" href="https://www.apache.org/licenses/LICENSE-2.0">
	
	License
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/stevehu" target="_blank" title="@stevehu on GitHub">
              @stevehu on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:stevehu@gmail.com" title="Email of stevehu@gmail.com">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>TodoList </h1>

			

<h1 id="introduction">Introduction</h1>

<p>This example can be found at <a href="https://github.com/networknt/light-eventuate-example/todo">https://github.com/networknt/light-eventuate-example/todo</a></p>

<p>The TodoList application is the entry point POC example application for the Light Eventuate. It illustrates how you can use the platform to write an application with a microservices architecture that uses Event Sourcing and Command Query Responsibility Segregation (CQRS). The TodoList application lets users maintain a todolist.</p>

<p>The TodoList application is a Java application built on Light-Java platform by using Event Sourcing based programming model. Todos are implemented by an Event Sourcing-based TodoAggregate. The aggregate&rsquo;s events are persisted in the Eventuate event store. The application also maintains a materialized view of the data in MySQL</p>

<p>There are five parts in this projects:</p>

<ul>
<li><p>common module define domain object and event object across module both command side and query side</p></li>

<li><p>Command side API implemented on top of light-eventuate-4j to build and publish events.</p></li>

<li><p>Command side microservice (Restful based or hybrid based) to trigger command API</p></li>

<li><p>Query side API implemented on top of light-eventuate-4j to define the event handles and subscribe events and process by defined event handles.</p></li>

<li><p>Query side microservice (Restful based or hybrid based) to trigger query API.</p></li>
</ul>

<h1 id="common-module">Common module</h1>

<p>common module define domain object and event object across module both command side and query side</p>

<p>The top level event class define entity annotations:</p>

<p>@EventEntity(entity = &ldquo;com.networknt.eventuate.todolist.domain.TodoAggregate&rdquo;)
public interface TodoEvent extends Event {
}</p>

<p>by default, light event sourcing framework will use the annotation defined &ldquo;com.networknt.eventuate.todolist.domain.TodoAggregate&rdquo; as entity type for entity table and topic name for Kafka.</p>

<p>#Command side API</p>

<p>Command side API implement command to process command and apply events. For todolist sample, it simply return TodoInfo object:</p>

<p>public class TodoAggregate extends ReflectiveMutableCommandProcessingAggregate<TodoAggregate, TodoCommand> {</p>

<pre><code>private TodoInfo todo;

private boolean deleted;

public List&lt;Event&gt; process(CreateTodoCommand cmd) {
    if (this.deleted) {
        return Collections.emptyList();
    }
    return EventUtil.events(new TodoCreatedEvent(cmd.getTodo()));
}

public List&lt;Event&gt; process(UpdateTodoCommand cmd) {
    if (this.deleted) {
        return Collections.emptyList();
    }
    return EventUtil.events(new TodoUpdatedEvent(cmd.getTodo()));
}

public List&lt;Event&gt; process(DeleteTodoCommand cmd) {
    if (this.deleted) {
        return Collections.emptyList();
    }
    return EventUtil.events(new TodoDeletedEvent());
}


public void apply(TodoCreatedEvent event) {
    this.todo = event.getTodo();
}

public void apply(TodoUpdatedEvent event) {
    this.todo = event.getTodo();
}

public void apply(TodoDeletedEvent event) {
    this.deleted = true;
}

public TodoInfo getTodo() {
    return todo;
}
</code></pre>

<p>}</p>

<p>#Command side microservice</p>

<p>Command side microservice is light-4j based microservice:</p>

<p><a href="https://networknt.github.io/light-4j/tutorials/microservices/">https://networknt.github.io/light-4j/tutorials/microservices/</a></p>

<p>It initially generated from swaggen specification based on light-codegen. The service generated resfful based microservice to expose API to external which can be call and trigger event sourcing system.</p>

<p>For example, exposed request API:</p>

<pre><code>public HttpHandler getHandler() {
    HttpHandler handler = Handlers.routing()
        .add(Methods.DELETE, &quot;/v1/todos/{id}&quot;, new TodosIdDeleteHandler())
        .add(Methods.POST, &quot;/v1/todos&quot;, new TodosPostHandler())
        .add(Methods.PUT, &quot;/v1/todos&quot;, new TodosPutHandler())
    ;
    return handler;
}
</code></pre>

<p>And then in the handler implementation, it will can command side service to publish events:</p>

<pre><code>public void handleRequest(HttpServerExchange exchange) throws Exception {
     ObjectMapper mapper = new ObjectMapper();

    // add a new object
    Map s = (Map)exchange.getAttachment(BodyHandler.REQUEST_BODY);
    String json = mapper.writeValueAsString(s);
    TodoInfo todo = mapper.readValue(json, TodoInfo.class);

    //TodoInfo todo2 = JSonMapper.fromJson(exchange.getAttachment(BodyHandler.REQUEST_BODY),  TodoInfo.class);
    CompletableFuture&lt;TodoInfo&gt; result = service.add(todo).thenApply((e) -&gt; {
        TodoInfo m = e.getAggregate().getTodo();
        return m;
    });

    exchange.getResponseHeaders().add(new HttpString(&quot;Content-Type&quot;), &quot;application/json&quot;);
    exchange.getResponseSender().send(Config.getInstance().getMapper().writeValueAsString(result));
}
</code></pre>

<p>#Query side API</p>

<p>Command side API implement event subscrible and process.</p>

<p>it defined event handler for process events:</p>

<p>@EventSubscriber(id = &ldquo;todoQuerySideEventHandlers&rdquo;)
public class TodoQueryWorkflow {</p>

<pre><code>private TodoQueryService service =
        (TodoQueryService)SingletonServiceFactory.getBean(TodoQueryService.class);

public TodoQueryWorkflow() {
}

@EventHandlerMethod
public void create(DispatchedEvent&lt;TodoCreatedEvent&gt; de) {
    TodoInfo todo = de.getEvent().getTodo();
    service.save(de.getEntityId(), todo);
}

@EventHandlerMethod
public void delete(DispatchedEvent&lt;TodoDeletedEvent&gt; de) {
    service.remove(de.getEntityId());
}

@EventHandlerMethod
public void update(DispatchedEvent&lt;TodoUpdatedEvent&gt; de) {
    TodoInfo todo = de.getEvent().getTodo();
    service.save(de.getEntityId(), todo);
}
</code></pre>

<p>}
The framework will based on the event handler definition the decide which handler will be used to process the events.</p>

<h1 id="query-side-microservice">Query side microservice</h1>

<p>Query side microservice is light-4j based microservice:</p>

<p><a href="https://networknt.github.io/light-4j/tutorials/microservices/">https://networknt.github.io/light-4j/tutorials/microservices/</a></p>

<p>It initially generated from swaggen specification based on light-codegen. The service generated resfful based microservice to expose API to external which can be call and subscrible the events from event sourcing system.</p>

<h2 id="integration-test">Integration Test</h2>

<p>From the root folder of the todo-list project: /light-eventuate-example/todo-list, use maven to build the project:</p>

<p>cmd: mvn clean install</p>

<pre><code>
</code></pre>

<p>Copy the command side serivce jar (eventuate-todo-command-service-0.1.0.jar) to framework&rsquo;s command serivce folder:</p>

<p>/light-eventuate-4j/command/service.</p>

<p>Start command side service:</p>

<pre><code>java -cp ./service/*:target/eventuate-command-1.3.0.jar com.networknt.server.Server
</code></pre>

<pre><code>
Copy the query side serivce jar (eventuate-todo-query-service-0.1.0.jar) to framework's query serivce folder:

/light-eventuate-4j/query/service.

Start query side service:

</code></pre>

<p>java -cp ./service/*:target/eventuate-query-1.3.0.jar com.networknt.server.Server
```</p>

<p>Open Postman, send POST request to URL:<a href="http://localhost:8083/v1/todos">http://localhost:8083/v1/todos</a>
with Json format request body:
{&ldquo;title&rdquo;:&rdquo; this is the  todo send from postman&rdquo;,&ldquo;completed&rdquo;:false,&ldquo;order&rdquo;:0}</p>

<p>It should get response:</p>

<p>{
  &ldquo;completedExceptionally&rdquo;: false,
  &ldquo;numberOfDependents&rdquo;: 0,
  &ldquo;cancelled&rdquo;: false,
  &ldquo;done&rdquo;: true
}</p>

<p>The request will publish a &ldquo;CreateTodo&rdquo; event and will save the entity/event to the event store mysql database.
 we can use sql to verify:</p>

<p>select * from entity;</p>

<p>select * from events;</p>

<p>The light event sourcing framework will trigger cdc, and publish the event to stream system (Kafka).</p>

<p>And query side service will get the event from kafka and process the event by event handle. For Todo application the query side service will save the todo list to local TODO table.</p>

<p>From the brower or Postman, send GET request: <a href="http://localhost:8083/v1/todos">http://localhost:8083/v1/todos</a>
we will see the TODO-list return from local TODO table.</p>

<h2 id="end">End</h2>


			<aside class="copyright" role="note">
				
				&copy; 2017 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://networknt.github.io/light-eventuate/" title="Index">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Index
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://networknt.github.io/light-eventuate/tutorial/end-to-end-test/" title="End to End Test">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              End to End Test
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/networknt.github.io\/light-eventuate\/';
      var repo_id  = 'networknt\/light-eventuate';
    
    </script>

    <script src="https://networknt.github.io/light-eventuate/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

