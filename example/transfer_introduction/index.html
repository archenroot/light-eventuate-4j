<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Account Money Transfer Introduction - Light Eventuate 4J - An event sourcing and CQRS framework with Kafka</title>
    <meta name="generator" content="Hugo 0.21" />

    
    <meta name="description" content="Light Eventuate Docs">
    
    <link rel="canonical" href="https://networknt.github.io/light-eventuate-4j/example/transfer_introduction/">
    
    <meta name="author" content="Steve Hu, Gavin Chen">
    

    <meta property="og:url" content="https://networknt.github.io/light-eventuate-4j/example/transfer_introduction/">
    <meta property="og:title" content="Light Eventuate 4J - An event sourcing and CQRS framework with Kafka">
    <meta property="og:image" content="https://networknt.github.io/light-eventuate-4j/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Light Eventuate 4J - An event sourcing and CQRS framework with Kafka">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://networknt.github.io/light-eventuate-4j/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://networknt.github.io/light-eventuate-4j/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://networknt.github.io/light-eventuate-4j/fonts/icon.eot');
        src: url('https://networknt.github.io/light-eventuate-4j/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://networknt.github.io/light-eventuate-4j/fonts/icon.woff')
               format('woff'),
             url('https://networknt.github.io/light-eventuate-4j/fonts/icon.ttf')
               format('truetype'),
             url('https://networknt.github.io/light-eventuate-4j/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://networknt.github.io/light-eventuate-4j/stylesheets/application.css">
    <link rel="stylesheet" href="https://networknt.github.io/light-eventuate-4j/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://networknt.github.io/light-eventuate-4j/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://networknt.github.io/light-eventuate-4j/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://networknt.github.io/light-eventuate-4j/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-red palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Account Money Transfer Introduction
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/stevehu" title="@stevehu on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/networknt/light-eventuate-4j" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://networknt.github.io/light-eventuate-4jimages/logo.png">
        </div>
      
      <div class="name">
        <strong>Light Eventuate 4J - An event sourcing and CQRS framework with Kafka <span class="version">1.3.3</span></strong>
        
          <br>
          networknt/light-eventuate-4j
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/networknt/light-eventuate-4j/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/networknt/light-eventuate-4j/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Getting started" href="https://networknt.github.io/light-eventuate-4j/getting-started/">
	
	Getting started
</a>



  
</li>



<li>
  
    



<a  title="Architecture" href="https://networknt.github.io/light-eventuate-4j/architecture/">
	
	Architecture
</a>



  
</li>



<li>
  
    



<a  title="Design" href="https://networknt.github.io/light-eventuate-4j/design/">
	
	Design
</a>



  
</li>



<li>
  
    



<a  title="Tutorial" href="https://networknt.github.io/light-eventuate-4j/tutorial/">
	
	Tutorial
</a>



  
</li>



<li>
  
    



<a  title="Example" href="https://networknt.github.io/light-eventuate-4j/example/">
	
	Example
</a>



  
</li>



<li>
  
    



<a  title="Issues &amp; Help" href="https://github.com/networknt/light-eventuate/issues">
	
	Issues &amp; Help
</a>



  
</li>



<li>
  
    



<a  title="Roadmap" href="https://networknt.github.io/light-eventuate-4j/roadmap/">
	
	Roadmap
</a>



  
</li>



<li>
  
    



<a  title="License" href="https://www.apache.org/licenses/LICENSE-2.0">
	
	License
</a>



  
</li>



<li>
  
    



<a  title="Introduction" href="https://networknt.github.io/light-eventuate-4j/index.html">
	
	Introduction
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/stevehu" target="_blank" title="@stevehu on GitHub">
              @stevehu on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:stevehu@gmail.com" title="Email of stevehu@gmail.com">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Account Money Transfer Introduction </h1>

			

<h1 id="introduction">Introduction</h1>

<p>This example can be found at <a href="https://github.com/networknt/light-eventuate-example/tree/master/account-management/account-service">https://github.com/networknt/light-eventuate-example/account-management</a></p>

<p>Account Money Transfer example is build on light-4j, light-rest-4j and light-eventuate-4j which
uses event sourcing and CQRS as major patterns to handle event process in multiple microservices.</p>

<p>The application consists of loosely coupled components that communicate using events and leverages
eventual consistency, event-driven approach rather than using tranditional distributed transaction.</p>

<p>These components can be deployed either as separate services or packaged as a monolithic application
for simplified development and testing.</p>

<h2 id="this-example-illustrates-several-important-concepts">This example illustrates several important concepts:</h2>

<ul>
<li><p>How to decompose an application into microservices - as described below the application consists of several services. For example, bank accounts are managed by one service, money transfers by another service.</p></li>

<li><p>Using an event-driven architecture to achieve data consistency - rather than using traditional distributed transaction to maintain database consistency this application uses an eventually consistent, event-driven approach.</p></li>

<li><p>Using event sourcing to implement the event-driven architecture - the domain logic consists of Domain-Driven Design (DDD) aggregates that using event sourcing.</p></li>

<li><p>Using Command Query Responsibility Segregation (CQRS) - update requests (HTTP POSTs and PUTs) and view requests (HTTP GETs) are handled by separate services.</p></li>

<li><p>How event sourcing enables deployment flexibility - the application can either be deployed as a monolith or as microservices.</p></li>
</ul>

<h1 id="structure-of-the-example">Structure of the example</h1>

<p>Modules:</p>

<ul>
<li><p>common - common module for the application, include DDD models and events for event sourcing.</p></li>

<li><p>command - command side common components, include command, services</p></li>

<li><p>query - query side common components, include command, services</p></li>

<li><p>e2etest - end to end test module</p></li>
</ul>

<h2 id="there-are-the-following-services">There are the following services:</h2>

<ul>
<li><p>Customers Service - REST API for creating customers</p></li>

<li><p>Accounts Service - REST API for creating accounts</p></li>

<li><p>Transactions Service - REST API for transferring money</p></li>

<li><p>Customers View Service - subscribes to events and updates query side material view. And it provides an API for retrieving customers</p></li>

<li><p>Accounts View Service - subscribes to events and updates query side material view. And it provides an API for retrieving accounts</p></li>
</ul>

<h1 id="event-work-flow">Event work flow:</h1>

<h2 id="customer-account-creation-and-deletion">Customer/Account creation and deletion</h2>

<p>Account Money Transfer example use event sourcing to handle the customer and account creation and deletion:</p>

<ul>
<li>On customer command side, system sent the create/delete customer commands and apply create/delete customer events</li>

<li><p>On customer view side, system subscrible the  create/delete customer events by registered event handles. On the example, system will process event and save or delete customer to local database.</p></li>

<li><p>On account command side, system sent the create/delete account commands and apply create/delete account events</p></li>

<li><p>On account view side, system subscrible the  create/delete account events by registered event handles. On the example, system will process event and save or Inactive account on local database.</p></li>

<li><p>On customer view side, system subscrible the delete account events by registered event handles, and will remove the customer/account relationship</p></li>
</ul>

<p><img src="https://networknt.github.io/light-eventuate-4j/images/account1.png" alt="account1" /></p>

<h2 id="money-transfer">Money Transfer:</h2>

<p>Account Money Transfer example use event sourcing to handle money transfer transaction control</p>

<ul>
<li>On transaction command side, system send money transfer command and apply the money transfer event with certain amount</li>
<li>On account command side, system subscrible the money transfer event. System will verify the account balance based on the debit event.</li>
<li>If the balance is not enough, system publish AccountDebitFailedDueToInsufficientFundsEvent. Otherwise, system send account debit event/account credit event.</li>
<li>On transaction command side, if subscribed events are account debit event/account credit event, system will process event and publish creditRecorded event and debitRecorded event,
if subscribed event is AccountDebitFailedDueToInsufficientFundsEvent, system will publish FailedDebitRecordedEvent.</li>
<li>On account view side, if subscribed events are creditRecorded event and debitRecorded event, system will update local account balance and update the transaction status to COMPLETED.
if subscribed even FailedDebitRecordedEvent, system will update transaction status to FAILED.</li>
</ul>

<p><img src="https://networknt.github.io/light-eventuate-4j/images/account2.png" alt="account2" /></p>


			<aside class="copyright" role="note">
				
				&copy; 2017 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
  </div>

  <div class="next">
  
      <a href="https://networknt.github.io/light-eventuate-4j/design/dup-events/" title="How to handle duplicated events in Kafka">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              How to handle duplicated events in Kafka
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/networknt.github.io\/light-eventuate-4j';
      var repo_id  = 'networknt\/light-eventuate-4j';
    
    </script>

    <script src="https://networknt.github.io/light-eventuate-4j/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

